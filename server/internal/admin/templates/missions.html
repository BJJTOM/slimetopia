{{define "missions.html"}}
{{template "layout.html" .}}
{{end}}

{{define "content"}}
{{if eq .Message "created"}}<div class="msg-success">생성 완료</div>
{{else if eq .Message "updated"}}<div class="msg-success">수정 완료</div>
{{else if eq .Message "saved"}}<div class="msg-success">저장 완료</div>
{{else if eq .Message "deleted"}}<div class="msg-success">삭제 완료</div>
{{else if eq .Message "error"}}<div class="msg-error">오류가 발생했습니다</div>
{{end}}

{{if .Error}}
<div class="msg-error">{{.Error}}</div>
{{end}}

<!-- Create Form -->
{{if .ShowCreate}}
<div class="stat-card" style="margin-bottom: 24px;">
  <div class="label" style="margin-bottom: 12px; font-size: 14px; color: #55efc4;">새 미션 생성</div>
  <form method="POST" action="/admin/gamedata/missions/create">
    <div class="form-row">
      <label style="min-width: 120px;">ID</label>
      <input type="number" name="id" placeholder="미션 ID" required style="width: 120px;" />
    </div>
    <div class="form-row">
      <label style="min-width: 120px;">Name</label>
      <input type="text" name="name" placeholder="미션 이름" required style="width: 250px;" />
    </div>
    <div class="form-row">
      <label style="min-width: 120px;">Description</label>
      <textarea name="description" placeholder="미션 설명" rows="2" style="width: 400px;"></textarea>
    </div>
    <div class="form-row">
      <label style="min-width: 120px;">Action</label>
      <select name="action" required style="width: 160px;">
        <option value="feed">feed</option>
        <option value="merge">merge</option>
        <option value="explore">explore</option>
        <option value="collect">collect</option>
        <option value="fish">fish</option>
        <option value="login">login</option>
        <option value="wheel">wheel</option>
        <option value="buy">buy</option>
      </select>
    </div>
    <div class="form-row">
      <label style="min-width: 120px;">Target</label>
      <input type="number" name="target" placeholder="목표 횟수" required style="width: 120px;" />
    </div>
    <div class="form-row">
      <label style="min-width: 120px;">Reward Gold</label>
      <input type="number" name="reward_gold" placeholder="보상 골드" value="0" style="width: 120px;" />
    </div>
    <div class="form-row">
      <label style="min-width: 120px;">Reward Gems</label>
      <input type="number" name="reward_gems" placeholder="보상 젬" value="0" style="width: 120px;" />
    </div>
    <div style="display: flex; gap: 8px; margin-top: 8px;">
      <button type="submit" class="btn btn-primary">생성</button>
      <a href="/admin/gamedata/missions" class="btn btn-danger btn-sm" style="display: inline-flex; align-items: center;">취소</a>
    </div>
  </form>
</div>
{{end}}

<!-- Edit Form -->
{{if .EditItem}}
{{with .EditItem}}
<div class="stat-card" style="margin-bottom: 24px; border-color: rgba(162,155,254,0.3);">
  <div class="label" style="margin-bottom: 12px; font-size: 14px; color: #a29bfe;">미션 #{{.ID}} 수정</div>
  <form method="POST" action="/admin/gamedata/missions/{{.ID}}/update">
    <div class="form-row">
      <label style="min-width: 120px;">ID</label>
      <span style="font-size: 13px; color: #636e72;">#{{.ID}} (변경 불가)</span>
    </div>
    <div class="form-row">
      <label style="min-width: 120px;">Name</label>
      <input type="text" name="name" value="{{.Name}}" required style="width: 250px;" />
    </div>
    <div class="form-row">
      <label style="min-width: 120px;">Description</label>
      <textarea name="description" rows="2" style="width: 400px;">{{.Description}}</textarea>
    </div>
    <div class="form-row">
      <label style="min-width: 120px;">Action</label>
      <select name="action" required style="width: 160px;">
        <option value="feed" {{if eq .Action "feed"}}selected{{end}}>feed</option>
        <option value="merge" {{if eq .Action "merge"}}selected{{end}}>merge</option>
        <option value="explore" {{if eq .Action "explore"}}selected{{end}}>explore</option>
        <option value="collect" {{if eq .Action "collect"}}selected{{end}}>collect</option>
        <option value="fish" {{if eq .Action "fish"}}selected{{end}}>fish</option>
        <option value="login" {{if eq .Action "login"}}selected{{end}}>login</option>
        <option value="wheel" {{if eq .Action "wheel"}}selected{{end}}>wheel</option>
        <option value="buy" {{if eq .Action "buy"}}selected{{end}}>buy</option>
      </select>
    </div>
    <div class="form-row">
      <label style="min-width: 120px;">Target</label>
      <input type="number" name="target" value="{{.Target}}" required style="width: 120px;" />
    </div>
    <div class="form-row">
      <label style="min-width: 120px;">Reward Gold</label>
      <input type="number" name="reward_gold" value="{{.RewardGold}}" style="width: 120px;" />
    </div>
    <div class="form-row">
      <label style="min-width: 120px;">Reward Gems</label>
      <input type="number" name="reward_gems" value="{{.RewardGems}}" style="width: 120px;" />
    </div>
    <div class="form-row">
      <label style="min-width: 120px;">Active</label>
      <input type="checkbox" name="is_active" {{if .IsActive}}checked{{end}} style="width: auto;" />
      <span style="font-size: 11px; color: #636e72;">비활성화 시 게임에서 사용 불가</span>
    </div>
    <div style="display: flex; gap: 8px; margin-top: 8px;">
      <button type="submit" class="btn btn-primary">저장</button>
      <a href="/admin/gamedata/missions" class="btn btn-danger btn-sm" style="display: inline-flex; align-items: center;">취소</a>
    </div>
  </form>
</div>
{{end}}
{{end}}

<!-- Missions Section -->
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
  <p style="font-size: 12px; color: #636e72;">총 {{.Total}}개 미션</p>
  {{if not .ShowCreate}}
  <a href="/admin/gamedata/missions?create=1" class="btn btn-primary btn-sm">+ 새 미션</a>
  {{end}}
</div>

<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>Name</th>
      <th>Description</th>
      <th>Action</th>
      <th>Target</th>
      <th>RewardGold</th>
      <th>RewardGems</th>
      <th>Active</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {{range .Missions}}
    <tr style="{{if not .IsActive}}opacity: 0.5;{{end}}">
      <td style="color: #636e72;">{{.ID}}</td>
      <td style="font-weight: 600;">{{.Name}}</td>
      <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: #b2bec3;">{{.Description}}</td>
      <td><span class="badge" style="background: rgba(162,155,254,0.15); color: #a29bfe;">{{.Action}}</span></td>
      <td style="color: #74b9ff;">{{.Target}}</td>
      <td style="color: #ffeaa7;">{{.RewardGold}}</td>
      <td style="color: #74b9ff;">{{.RewardGems}}</td>
      <td>{{if .IsActive}}<span style="color: #55efc4;">활성</span>{{else}}<span style="color: #ff6b6b;">비활성</span>{{end}}</td>
      <td style="white-space: nowrap;">
        <a href="/admin/gamedata/missions?edit={{.ID}}" class="btn btn-sm btn-warning">수정</a>
        <form method="POST" action="/admin/gamedata/missions/{{.ID}}/delete" style="display:inline; margin-left: 4px;">
          <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('미션 #{{.ID}}을(를) 정말 삭제하시겠습니까?')">삭제</button>
        </form>
      </td>
    </tr>
    {{else}}
    <tr><td colspan="9" style="text-align:center; color:#636e72; padding: 24px;">미션 데이터 없음</td></tr>
    {{end}}
  </tbody>
</table>

<!-- Attendance Rewards Section -->
{{if .Attendance}}
<div style="margin-top: 40px;">
  <h3 style="font-size: 16px; color: #e8e4f0; margin-bottom: 12px;">출석 보상 (읽기 전용)</h3>
  <table>
    <thead>
      <tr>
        <th>Day</th>
        <th>Gold</th>
        <th>Gems</th>
      </tr>
    </thead>
    <tbody>
      {{range .Attendance}}
      <tr>
        <td style="color: #74b9ff; font-weight: 600;">{{.Day}}일차</td>
        <td style="color: #ffeaa7;">{{.Gold}}</td>
        <td style="color: #74b9ff;">{{.Gems}}</td>
      </tr>
      {{else}}
      <tr><td colspan="3" style="text-align:center; color:#636e72; padding: 24px;">출석 보상 데이터 없음</td></tr>
      {{end}}
    </tbody>
  </table>
</div>
{{end}}
{{end}}