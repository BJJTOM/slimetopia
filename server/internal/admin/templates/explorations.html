{{define "explorations.html"}}
{{template "layout.html" .}}
{{end}}

{{define "content"}}
{{if eq .Message "created"}}<div class="msg-success">ìƒì„± ì™„ë£Œ</div>{{else if eq .Message "updated"}}<div class="msg-success">ìˆ˜ì • ì™„ë£Œ</div>{{else if eq .Message "deleted"}}<div class="msg-success">ì‚­ì œ ì™„ë£Œ</div>{{else if eq .Message "error"}}<div class="msg-error">ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</div>{{end}}

<!-- Create Form -->
{{if .ShowCreate}}
<div class="stat-card" style="margin-bottom: 24px;">
  <div class="label" style="margin-bottom: 16px; font-size: 16px; color: #55efc4;">ìƒˆ íƒí—˜ ìƒì„±</div>
  <form method="POST" action="/admin/gamedata/explorations/create">
    <div class="form-row">
      <label style="color: #b2bec3; font-size: 13px;">ID</label>
      <input type="number" name="id" required style="width: 120px;" />
    </div>
    <div class="form-row">
      <label style="color: #b2bec3; font-size: 13px;">ì´ë¦„</label>
      <input type="text" name="name" required style="width: 300px;" />
    </div>
    <div class="form-row">
      <label style="color: #b2bec3; font-size: 13px;">ì†Œìš” ì‹œê°„ (ë¶„)</label>
      <input type="number" name="duration_minutes" required style="width: 120px;" />
    </div>
    <div class="form-row">
      <label style="color: #b2bec3; font-size: 13px;">ì¶”ì²œ ì†ì„±</label>
      <select name="recommended_element" style="width: 160px;">
        <option value="water">water</option>
        <option value="fire">fire</option>
        <option value="grass">grass</option>
        <option value="light">light</option>
        <option value="dark">dark</option>
        <option value="ice">ice</option>
        <option value="electric">electric</option>
        <option value="poison">poison</option>
        <option value="earth">earth</option>
        <option value="wind">wind</option>
        <option value="celestial">celestial</option>
      </select>
    </div>
    <div class="form-row">
      <label style="color: #b2bec3; font-size: 13px;">ë³´ìƒ (JSON)</label>
      <textarea name="rewards" rows="4" style="width: 100%; font-family: monospace; font-size: 12px;" placeholder='{"gold": {"min": 50, "max": 100}, "items": []}'></textarea>
    </div>
    <div class="form-row">
      <label style="color: #b2bec3; font-size: 13px;">í•´ê¸ˆ ì¡°ê±´</label>
      <select name="unlock_type" style="width: 140px;">
        <option value="default">default</option>
        <option value="level">level</option>
      </select>
    </div>
    <div class="form-row">
      <label style="color: #b2bec3; font-size: 13px;">í•´ê¸ˆ ê°’</label>
      <input type="number" name="unlock_value" value="0" style="width: 120px;" />
    </div>
    <div class="form-row">
      <label style="color: #b2bec3; font-size: 13px;">ì¬ë£Œ ë“œë¡­ (JSON)</label>
      <textarea name="material_drops" rows="4" style="width: 100%; font-family: monospace; font-size: 12px;" placeholder='[{"material_id": 1, "chance": 0.5, "min_qty": 1, "max_qty": 3}]'></textarea>
    </div>
    <div class="form-row">
      <label style="color: #b2bec3; font-size: 13px;">ì •ë ¬ ìˆœì„œ</label>
      <input type="number" name="sort_order" value="0" style="width: 120px;" />
    </div>
    <div style="margin-top: 16px; display: flex; gap: 8px;">
      <button type="submit" class="btn btn-primary">ìƒì„±</button>
      <a href="/admin/gamedata/explorations" class="btn btn-sm" style="background: rgba(255,255,255,0.06); color: #b2bec3;">ì·¨ì†Œ</a>
    </div>
  </form>
</div>
{{end}}

<!-- Edit Form -->
{{if .EditItem}}
<div class="stat-card" style="margin-bottom: 24px;">
  <div class="label" style="margin-bottom: 16px; font-size: 16px; color: #a29bfe;">íƒí—˜ ìˆ˜ì • â€” #{{.EditItem.ID}}</div>
  <form method="POST" action="/admin/gamedata/explorations/{{.EditItem.ID}}/update">
    <div class="form-row">
      <label style="color: #b2bec3; font-size: 13px;">ID</label>
      <input type="number" name="id" value="{{.EditItem.ID}}" readonly style="width: 120px; opacity: 0.5;" />
    </div>
    <div class="form-row">
      <label style="color: #b2bec3; font-size: 13px;">ì´ë¦„</label>
      <input type="text" name="name" value="{{.EditItem.Name}}" required style="width: 300px;" />
    </div>
    <div class="form-row">
      <label style="color: #b2bec3; font-size: 13px;">ì†Œìš” ì‹œê°„ (ë¶„)</label>
      <input type="number" name="duration_minutes" value="{{.EditItem.DurationMinutes}}" required style="width: 120px;" />
    </div>
    <div class="form-row">
      <label style="color: #b2bec3; font-size: 13px;">ì¶”ì²œ ì†ì„±</label>
      <select name="recommended_element" style="width: 160px;">
        <option value="water" {{if eq .EditItem.RecommendedElement "water"}}selected{{end}}>water</option>
        <option value="fire" {{if eq .EditItem.RecommendedElement "fire"}}selected{{end}}>fire</option>
        <option value="grass" {{if eq .EditItem.RecommendedElement "grass"}}selected{{end}}>grass</option>
        <option value="light" {{if eq .EditItem.RecommendedElement "light"}}selected{{end}}>light</option>
        <option value="dark" {{if eq .EditItem.RecommendedElement "dark"}}selected{{end}}>dark</option>
        <option value="ice" {{if eq .EditItem.RecommendedElement "ice"}}selected{{end}}>ice</option>
        <option value="electric" {{if eq .EditItem.RecommendedElement "electric"}}selected{{end}}>electric</option>
        <option value="poison" {{if eq .EditItem.RecommendedElement "poison"}}selected{{end}}>poison</option>
        <option value="earth" {{if eq .EditItem.RecommendedElement "earth"}}selected{{end}}>earth</option>
        <option value="wind" {{if eq .EditItem.RecommendedElement "wind"}}selected{{end}}>wind</option>
        <option value="celestial" {{if eq .EditItem.RecommendedElement "celestial"}}selected{{end}}>celestial</option>
      </select>
    </div>
    <div class="form-row">
      <label style="color: #b2bec3; font-size: 13px;">ë³´ìƒ (JSON)</label>
      <textarea name="rewards" rows="4" style="width: 100%; font-family: monospace; font-size: 12px;">{{jsonStr .EditItem.Rewards}}</textarea>
    </div>
    <div class="form-row">
      <label style="color: #b2bec3; font-size: 13px;">í•´ê¸ˆ ì¡°ê±´</label>
      <select name="unlock_type" style="width: 140px;">
        <option value="default" {{if eq .EditItem.UnlockType "default"}}selected{{end}}>default</option>
        <option value="level" {{if eq .EditItem.UnlockType "level"}}selected{{end}}>level</option>
      </select>
    </div>
    <div class="form-row">
      <label style="color: #b2bec3; font-size: 13px;">í•´ê¸ˆ ê°’</label>
      <input type="number" name="unlock_value" value="{{.EditItem.UnlockValue}}" style="width: 120px;" />
    </div>
    <div class="form-row">
      <label style="color: #b2bec3; font-size: 13px;">ì¬ë£Œ ë“œë¡­ (JSON)</label>
      <textarea name="material_drops" rows="4" style="width: 100%; font-family: monospace; font-size: 12px;">{{jsonStr .EditItem.MaterialDrops}}</textarea>
    </div>
    <div class="form-row">
      <label style="color: #b2bec3; font-size: 13px;">ì •ë ¬ ìˆœì„œ</label>
      <input type="number" name="sort_order" value="{{.EditItem.SortOrder}}" style="width: 120px;" />
    </div>
    <div class="form-row">
      <label style="color: #b2bec3; font-size: 13px;">í™œì„±í™”</label>
      <input type="checkbox" name="is_active" value="true" {{if .EditItem.IsActive}}checked{{end}} />
    </div>
    <div style="margin-top: 16px; display: flex; gap: 8px;">
      <button type="submit" class="btn btn-primary">ìˆ˜ì •</button>
      <a href="/admin/gamedata/explorations" class="btn btn-sm" style="background: rgba(255,255,255,0.06); color: #b2bec3;">ì·¨ì†Œ</a>
    </div>
  </form>
</div>
{{end}}

<!-- Header -->
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
  <h2 style="margin: 0; font-size: 18px; color: #dfe6e9;">íƒí—˜ ëª©ë¡</h2>
  <a href="/admin/gamedata/explorations?create=1" class="btn btn-primary">+ ìƒˆ íƒí—˜</a>
</div>

<!-- Exploration Cards -->
<div style="display: grid; gap: 16px;">
  {{range .Explorations}}
  <div class="stat-card" style="{{if not .IsActive}}opacity: 0.5;{{end}}">
    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
      <div style="flex: 1;">
        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
          <span style="font-size: 20px; font-weight: 700; color: #dfe6e9;">{{.Name}}</span>
          <span style="font-size: 12px; color: #636e72;">#{{.ID}}</span>
          <span style="font-size: 11px; padding: 2px 8px; border-radius: 4px; background: rgba(116,185,255,0.15); color: #74b9ff;">
            {{if eq .RecommendedElement "water"}}ğŸ’§{{else if eq .RecommendedElement "fire"}}ğŸ”¥{{else if eq .RecommendedElement "grass"}}ğŸŒ¿{{else if eq .RecommendedElement "light"}}âœ¨{{else if eq .RecommendedElement "dark"}}ğŸŒ‘{{else if eq .RecommendedElement "ice"}}â„ï¸{{else if eq .RecommendedElement "electric"}}âš¡{{else if eq .RecommendedElement "poison"}}â˜ ï¸{{else if eq .RecommendedElement "earth"}}ğŸª¨{{else if eq .RecommendedElement "wind"}}ğŸŒªï¸{{else if eq .RecommendedElement "celestial"}}ğŸŒŸ{{end}}
            {{.RecommendedElement}}
          </span>
          {{if not .IsActive}}<span style="font-size: 11px; padding: 2px 8px; border-radius: 4px; background: rgba(255,107,107,0.15); color: #ff6b6b;">ë¹„í™œì„±</span>{{end}}
        </div>
        <div style="display: flex; gap: 24px; margin-bottom: 12px; font-size: 13px;">
          <div><span style="color: #636e72;">ì†Œìš” ì‹œê°„:</span> <span style="color: #ffeaa7;">{{.DurationMinutes}}ë¶„</span></div>
          <div><span style="color: #636e72;">í•´ê¸ˆ:</span> <span style="color: #b2bec3;">{{.UnlockType}}</span>{{if .UnlockValue}} <span style="color: #74b9ff;">({{.UnlockValue}})</span>{{end}}</div>
          <div><span style="color: #636e72;">ì •ë ¬:</span> <span style="color: #b2bec3;">{{.SortOrder}}</span></div>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
          <div>
            <div style="font-size: 11px; color: #55efc4; margin-bottom: 4px; font-weight: 600;">ë³´ìƒ (Rewards)</div>
            <pre style="background: rgba(0,0,0,0.3); border-radius: 6px; padding: 8px; font-size: 11px; color: #dfe6e9; margin: 0; white-space: pre-wrap; word-break: break-all; max-height: 120px; overflow-y: auto;">{{jsonPretty .Rewards}}</pre>
          </div>
          <div>
            <div style="font-size: 11px; color: #fdcb6e; margin-bottom: 4px; font-weight: 600;">ì¬ë£Œ ë“œë¡­ (MaterialDrops)</div>
            <pre style="background: rgba(0,0,0,0.3); border-radius: 6px; padding: 8px; font-size: 11px; color: #dfe6e9; margin: 0; white-space: pre-wrap; word-break: break-all; max-height: 120px; overflow-y: auto;">{{jsonPretty .MaterialDrops}}</pre>
          </div>
        </div>
      </div>
      <div style="display: flex; gap: 6px; margin-left: 16px; flex-shrink: 0;">
        <a href="/admin/gamedata/explorations?edit={{.ID}}" class="btn btn-warning btn-sm">ìˆ˜ì •</a>
        <form method="POST" action="/admin/gamedata/explorations/{{.ID}}/delete" style="margin: 0;">
          <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ì‚­ì œ</button>
        </form>
      </div>
    </div>
  </div>
  {{else}}
  <div style="text-align: center; color: #636e72; padding: 40px;">íƒí—˜ ë°ì´í„° ì—†ìŒ</div>
  {{end}}
</div>
{{end}}